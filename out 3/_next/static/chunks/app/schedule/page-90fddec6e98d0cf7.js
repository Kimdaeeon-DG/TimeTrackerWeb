(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{1086:function(e,t,r){Promise.resolve().then(r.bind(r,7546))},7546:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var s=r(3827),n=r(4090),a=r(8792),l=r(7835),i=r(9315),c=r(1263),o=r(666),d=r(9686),u=r(3437),h=r(5493),m=r(1825),x=r(1835),g=r(1067),f=r(4970),p=r(6618),b=r(6053),y=r(8855),w=r(7397),j=r(2674),N=r(3336),_=r(8009);function v(){let[e,t]=(0,n.useState)(new Date),[r,v]=(0,n.useState)([]),[k,O]=(0,n.useState)([]),[E,S]=(0,n.useState)(null),[M,D]=(0,n.useState)([]),[U,Z]=(0,n.useState)(!0),[P,C]=(0,n.useState)(null),[F,I]=(0,n.useState)(0),[q,J]=(0,n.useState)(!1),[W,Y]=(0,n.useState)(null),[A,X]=(0,n.useState)(""),[H,T]=(0,n.useState)(""),[z,V]=(0,n.useState)(0),[K,Q]=(0,n.useState)(!1),[R,G]=(0,n.useState)(""),[L,B]=(0,n.useState)(!1);(0,n.useEffect)(()=>{console.log("Schedule 페이지 로드됨")},[]),(0,n.useEffect)(()=>{(async function(){try{Z(!0),C(null);let t=await (0,j.s_)(e.getFullYear(),e.getMonth()+1),r=await (0,N.F8)();v(t||[]),O(r||[]);let s=0;t.forEach(e=>{s+=parseFloat(e.planned_hours.toString())}),I(s),Z(!1)}catch(e){console.error("Error loading data:",e),C("데이터를 불러오는 중 오류가 발생했습니다: ".concat(e.message||String(e))),Z(!1)}})()},[e]);let $=(0,c.N)(e),ee=(0,o.V)(e),et=(0,d.D)({start:$,end:ee}),er=(0,u.w)($),es=async t=>{if(K&&E&&E!==t){try{Z(!0);let r=await (0,j.Yx)(M,t);if(r.success){_.ZP.success("근무 계획이 ".concat((0,h.WU)((0,m.D)(t),"yyyy년 MM월 dd일"),"에 복사되었습니다."),{duration:2e3});let r=await (0,j.s_)(e.getFullYear(),e.getMonth()+1);v(r||[])}else _.ZP.error(r.message||"근무 계획 복사 중 오류가 발생했습니다.")}catch(e){console.error("Error copying work schedules:",e),_.ZP.error(e.message||"근무 계획 복사 중 오류가 발생했습니다.")}finally{Z(!1)}return}if(L&&t){try{Z(!0);let r=await (0,j.Fs)(t);if(0===r.length){_.ZP.error("".concat((0,h.WU)((0,m.D)(t),"yyyy년 MM월 dd일"),"에는 삭제할 근무 계획이 없습니다.")),Z(!1);return}let s=r.map(e=>(0,j.Nw)(e.id));await Promise.all(s),_.ZP.success("".concat((0,h.WU)((0,m.D)(t),"yyyy년 MM월 dd일"),"의 근무 계획 ").concat(r.length,"개가 삭제되었습니다."),{duration:2e3});let n=await (0,j.s_)(e.getFullYear(),e.getMonth()+1);v(n||[])}catch(e){console.error("Error deleting work schedules:",e),_.ZP.error(e.message||"근무 계획 삭제 중 오류가 발생했습니다.")}finally{Z(!1)}return}S(t);try{let e=await (0,j.Fs)(t);D(e),ei()}catch(e){console.error("Error fetching schedules for date:",e),_.ZP.error("해당 날짜의 근무 계획을 불러오는데 실패했습니다.")}};function en(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.floor(e),s=Math.round((e-r)*60);return t?"".concat(r,".").concat(Math.floor(s/6),"h"):"".concat(r,"시간 ").concat(s,"분")}function ea(e){let t=new Date,r=new Date(e);return t.setHours(0,0,0,0),r.setHours(0,0,0,0),r<t}let el=e=>{J(!1),Y(e),X(e.start_time.substring(0,5)),T(e.end_time.substring(0,5)),V(e.planned_hours)},ei=()=>{J(!1),Y(null),X(""),T(""),V(0),Q(!1),G("")},ec=(e,t)=>{if(!e||!t)return;let[r,s]=e.split(":").map(Number),[n,a]=t.split(":").map(Number),l=60*n+a-(60*r+s);l<0&&(l+=1440),V(parseFloat((l/60).toFixed(2)))},eo=async()=>{if(!E||!A||!H){_.ZP.error("모든 필드를 입력해주세요.");return}try{Z(!0),W?await (0,j.A0)(W.id,A,H,z)&&_.ZP.success("근무 계획이 수정되었습니다."):await (0,j.Xk)(E,A,H,z)&&(_.ZP.success("근무 계획이 추가되었습니다."),X("09:00"),T("18:00"),ec("09:00","18:00"));let t=await (0,j.s_)(e.getFullYear(),e.getMonth()+1);if(v(t||[]),E){let e=await (0,j.Fs)(E);D(e)}W&&ei()}catch(e){console.error("Error saving work schedule:",e),_.ZP.error("근무 계획 저장 중 오류가 발생했습니다.")}finally{Z(!1)}},ed=async t=>{try{if(Z(!0),await (0,j.Nw)(t)){_.ZP.success("근무 계획이 삭제되었습니다.");let r=await (0,j.s_)(e.getFullYear(),e.getMonth()+1);if(v(r||[]),E){let e=await (0,j.Fs)(E);D(e)}W&&W.id===t&&ei()}}catch(e){console.error("Error deleting work schedule:",e),_.ZP.error("근무 계획 삭제 중 오류가 발생했습니다.")}finally{Z(!1)}};return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)(_.x7,{position:"top-right"}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"근무 계획"}),(0,s.jsx)(a.default,{href:"/timer",className:"bg-primary text-white px-4 py-2 rounded hover:bg-blue-700",children:"출퇴근 기록"})]}),U&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,s.jsx)("span",{className:"ml-3",children:"데이터를 불러오는 중..."})]}),P&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,s.jsx)("p",{children:P}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"Supabase 연결 및 환경 변수를 확인해주세요."})]}),!U&&!P&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"근무 계획 요약"}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"이번 달 계획 근무 시간"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:en(F)})]})})]}),!U&&!P&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:()=>{t((0,l.W)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:"<"}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:(0,h.WU)(e,"yyyy년 MM월",{locale:w.ko})}),(0,s.jsx)("button",{onClick:()=>{t((0,i.z)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:">"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["일","월","화","수","목","금","토"].map((e,t)=>(0,s.jsx)("div",{className:"text-center font-semibold p-2 ".concat(0===t?"text-red-600":6===t?"text-blue-600":""),children:e},e)),Array.from({length:er}).map((e,t)=>(0,s.jsx)("div",{className:"p-2 min-h-[60px]"},"empty-".concat(t))),et.map(e=>{let t=(0,h.WU)(e,"yyyy-MM-dd"),n=(0,x.b)(e),a=(0,g.i)(e),l=0;k.forEach(e=>{if(!e.check_in||!e.check_out)return;let t=(0,m.D)(e.check_in),r=(0,m.D)(e.check_out);if(t<=a&&r>=n||t<=a&&r<n&&!(0,f.K)(t,r)){let e=t>n?t:n,s=r<a?r:a;if((0,p.A)(s,e)){let t=(0,b.A)(s,e)+(0,y.X)(s,e)%60/60;l+=t}}});let i=r.filter(e=>e.date===t),c=0;i.forEach(e=>{c+=parseFloat(e.planned_hours.toString())}),ea(t)&&(i.length>0?c=l:l>0&&(c=l));let o=i.length>0||ea(t)&&l>0,d=E===t;return(0,s.jsxs)("div",{className:"p-2 min-h-[60px] border ".concat(d?"border-blue-500":K?"border-gray-200 hover:border-green-500":L?"border-gray-200 hover:border-red-500":"border-gray-200"," cursor-pointer hover:bg-gray-50 ").concat(K&&E===t?"bg-blue-50":""," ").concat(L?"hover:bg-red-50":""),onClick:()=>es(t),children:[(0,s.jsx)("div",{className:"font-medium ".concat(6===(0,u.w)(e)?"text-blue-600":0===(0,u.w)(e)?"text-red-600":""),children:(0,h.WU)(e,"d")}),o&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)("span",{className:"text-green-600 text-sm font-medium",children:en(c,!0)})})]},t)})]})]}),E&&!U&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:[(0,h.WU)((0,m.D)(E),"yyyy년 MM월 dd일"),(0,s.jsx)("br",{}),"근무 계획"]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{if(0===M.length){_.ZP.error("복사할 근무 계획이 없습니다.");return}Q(!0),_.ZP.success("복사 모드가 활성화되었습니다. 달력에서 여러 대상 날짜를 선택하세요. 완료 후 복사 취소 버튼을 클릭하세요.",{duration:5e3,icon:"\uD83D\uDD04"})},className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"계획 복사"}),(0,s.jsx)("button",{onClick:()=>{B(!0),_.ZP.success("삭제 모드가 활성화되었습니다. 달력에서 삭제할 날짜를 선택하세요. 완료 후 삭제 모드 종료 버튼을 클릭하세요.",{duration:5e3,icon:"\uD83D\uDDD1️"})},className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"계획 삭제"}),(0,s.jsx)("button",{onClick:()=>{J(!0),Y(null),X("09:00"),T("18:00"),ec("09:00","18:00")},className:"bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600",children:"+ 계획 추가"})]})]}),K&&(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-1",children:"근무 계획 복사 모드"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,h.WU)((0,m.D)(E),"yyyy년 MM월 dd일"),"의 근무 계획 ",M.length,"개를 여러 날짜에 복사할 수 있습니다. 달력에서 대상 날짜를 선택하세요."]})]}),(0,s.jsx)("button",{onClick:()=>{Q(!1),_.ZP.success("복사 모드가 취소되었습니다.")},className:"px-3 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50",children:"복사 모드 종료"})]}),L&&(0,s.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-1",children:"근무 계획 삭제 모드"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"달력에서 삭제할 날짜를 선택하세요. 해당 날짜의 모든 근무 계획이 삭제됩니다."})]}),(0,s.jsx)("button",{onClick:()=>{B(!1),_.ZP.success("삭제 모드가 취소되었습니다.")},className:"px-3 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50",children:"삭제 모드 종료"})]}),(q||W)&&(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[(0,s.jsx)("h3",{className:"font-medium mb-3",children:W?"근무 계획 수정":"새 근무 계획 추가"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),(0,s.jsx)("input",{type:"time",value:A,onChange:e=>{let t=e.target.value;X(t),ec(t,H)},className:"w-full p-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),(0,s.jsx)("input",{type:"time",value:H,onChange:e=>{let t=e.target.value;T(t),ec(A,t)},className:"w-full p-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"계획 시간"}),(0,s.jsx)("div",{className:"p-2 border rounded bg-gray-100",children:en(z)})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:ei,className:"px-3 py-1 border rounded hover:bg-gray-100",children:"취소"}),(0,s.jsx)("button",{onClick:eo,className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"저장"})]})]}),M.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"시작 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종료 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"계획 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.start_time.substring(0,5)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.end_time.substring(0,5)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-green-600",children:en(e.planned_hours)}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>el(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"수정"}),(0,s.jsx)("button",{onClick:()=>ed(e.id),className:"text-red-600 hover:text-red-900",children:"삭제"})]})]},e.id))})]})}):(0,s.jsx)("div",{className:"text-center py-6 text-gray-500",children:q?"새 근무 계획을 추가해주세요.":"이 날짜에 등록된 근무 계획이 없습니다. 계획 추가 버튼을 클릭하여 추가해주세요."})]})]})}},8667:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},3336:function(e,t,r){"use strict";r.d(t,{Av:function(){return n},Dg:function(){return i},F8:function(){return o},eh:function(){return c},lp:function(){return a},se:function(){return l}});var s=r(8667);async function n(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:n}=await s.O.from("time_entries").select("*").eq("date",e).eq("user_id",t.id).order("check_in",{ascending:!0});return n?(console.error("Error fetching time entries:",n),[]):r}async function a(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),null;console.log("출근 기록 생성 - 사용자 ID:",r.id);let{data:n,error:a}=await s.O.from("time_entries").insert([{date:e,check_in:t,check_out:null,working_hours:null,user_id:r.id}]).select();return a?(console.error("Error creating check-in entry:",a),null):n[0]}async function l(e,t,r){let{data:{user:n}}=await s.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:a,error:l}=await s.O.from("time_entries").update({check_out:t,working_hours:r}).eq("id",e).eq("user_id",n.id).select();return l?(console.error("Error updating check-out entry:",l),null):a[0]}async function i(e,t,r,n,a){let{data:{user:l}}=await s.O.auth.getUser();if(!l)return console.error("사용자가 로그인되어 있지 않습니다."),null;let i={check_in:t,check_out:r,working_hours:n};a&&(i.date=a);let{data:c,error:o}=await s.O.from("time_entries").update(i).eq("id",e).eq("user_id",l.id).select();return o?(console.error("Error updating time entry:",o),null):c[0]}async function c(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await s.O.from("time_entries").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting time entry:",r),!1)}async function o(){console.log("getAllTimeEntries 함수 호출됨"),console.log("Supabase URL:","https://ijsggnmyblatollrvkhf.supabase.co"),console.log("Supabase Key 설정 여부:",!0);try{let{data:{user:e}}=await s.O.auth.getUser();if(!e)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:t,error:r}=await s.O.from("time_entries").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(r)return console.error("Error fetching all time entries:",r),[];return console.log("가져온 데이터 수:",t?t.length:0),t||[]}catch(e){return console.error("Exception in getAllTimeEntries:",e),[]}}},2674:function(e,t,r){"use strict";r.d(t,{A0:function(){return c},Fs:function(){return l},Nw:function(){return o},Xk:function(){return i},Yx:function(){return n},s_:function(){return a}});var s=r(8667);async function n(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),{success:!1,message:"로그인이 필요합니다."};try{let n=[];for(let a of e){let{data:e,error:l}=await s.O.from("work_schedules").insert([{date:t,start_time:a.start_time,end_time:a.end_time,planned_hours:a.planned_hours,user_id:r.id}]).select();if(l)throw l;n.push(e[0])}return{success:!0,data:n}}catch(e){return console.error("Error copying work schedules:",e),{success:!1,message:e.message||"근무 계획 복사 중 오류가 발생했습니다."}}}async function a(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),[];let n=t.toString().padStart(2,"0"),a="".concat(e,"-").concat(n,"-01"),l=12===t?"".concat(e+1,"-01-01"):"".concat(e,"-").concat((t+1).toString().padStart(2,"0"),"-01"),{data:i,error:c}=await s.O.from("work_schedules").select("*").eq("user_id",r.id).gte("date",a).lt("date",l).order("date",{ascending:!0}).order("start_time",{ascending:!0});return c?(console.error("Error fetching work schedules:",c),[]):i||[]}async function l(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:n}=await s.O.from("work_schedules").select("*").eq("date",e).eq("user_id",t.id).order("start_time",{ascending:!0});return n?(console.error("Error fetching work schedules for date:",n),[]):r||[]}async function i(e,t,r,n){let{data:{user:a}}=await s.O.auth.getUser();if(!a)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await s.O.from("work_schedules").insert([{date:e,start_time:t,end_time:r,planned_hours:n,user_id:a.id}]).select();return i?(console.error("Error creating work schedule:",i),null):l[0]}async function c(e,t,r,n){let{data:{user:a}}=await s.O.auth.getUser();if(!a)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await s.O.from("work_schedules").update({start_time:t,end_time:r,planned_hours:n,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",a.id).select();return i?(console.error("Error updating work schedule:",i),null):l[0]}async function o(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await s.O.from("work_schedules").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting work schedule:",r),!1)}}},function(e){e.O(0,[549,792,493,672,9,971,69,744],function(){return e(e.s=1086)}),_N_E=e.O()}]);