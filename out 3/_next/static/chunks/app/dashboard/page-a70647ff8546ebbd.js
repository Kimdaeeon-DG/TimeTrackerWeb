(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2481:function(e,t,r){Promise.resolve().then(r.bind(r,7736))},7736:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var n=r(3827),s=r(4090),a=r(8792),l=r(5493),i=r(7835),c=r(9315),o=r(1263),d=r(666),u=r(9686),h=r(3437),m=r(1825),f=r(1835),g=r(1067),x=r(4970),p=r(6618),w=r(6053),b=r(8855),y=r(7397),_=r(3336),j=r(2674);function k(){let[e,t]=(0,s.useState)(new Date),[r,k]=(0,s.useState)([]),[N,v]=(0,s.useState)([]),[S,O]=(0,s.useState)(0),[D,E]=(0,s.useState)(null),[M,U]=(0,s.useState)([]),[T,I]=(0,s.useState)(!0),[q,C]=(0,s.useState)(null),[H,W]=(0,s.useState)(0),[F,X]=(0,s.useState)(0),[A,J]=(0,s.useState)(0),[L,z]=(0,s.useState)(null),[K,Y]=(0,s.useState)(""),[R,V]=(0,s.useState)(""),[Z,Q]=(0,s.useState)("");(0,s.useEffect)(()=>{console.log("Dashboard 페이지 로드됨"),console.log("Supabase URL:","설정됨"),console.log("Supabase Anon Key:","설정됨")},[]),(0,s.useEffect)(()=>{(async function(){try{I(!0),C(null);let t=await (0,_.F8)();console.log("Loaded entries:",t),k(t||[]);let r=await (0,j.s_)(e.getFullYear(),e.getMonth()+1);console.log("Loaded work schedules:",r),v(r||[]);let n=(0,l.WU)(e,"yyyy-MM"),s=t?t.filter(e=>e.date.startsWith(n)):[],a=0;s.length>0&&s.forEach(e=>{if(e.working_hours)a+=e.working_hours;else if(e.check_in&&!e.check_out){let t=new Date(e.check_in),r=(new Date().getTime()-t.getTime())/36e5;a+=r}}),O(a);let i=new Date,c=(0,l.WU)(i,"yyyy-MM-dd"),o=r?r.filter(e=>e.date===c):[],d=0;o.forEach(e=>{d+=parseFloat(e.planned_hours.toString())}),X(d);let u=t?t.filter(e=>e.date===c):[],h=0;u.forEach(e=>{if(null!==e.working_hours)h+=parseFloat(e.working_hours.toString());else if(e.check_in&&!e.check_out){let t=new Date(e.check_in),r=(new Date().getTime()-t.getTime())/36e5;h+=r}}),W(h);let m=d>0?Math.max(0,d-h):0;J(m),I(!1)}catch(e){console.error("Error loading data:",e),C("데이터를 불러오는 중 오류가 발생했습니다: ".concat(e.message||String(e))),I(!1)}})()},[e]);let B=(0,o.N)(e),G=(0,d.V)(e),P=(0,u.D)({start:B,end:G}),$=(0,h.w)(B),ee=e=>{E(e),U(r.filter(t=>t.date===e).sort((e,t)=>(e.check_in?new Date(e.check_in).getTime():0)-(t.check_in?new Date(t.check_in).getTime():0)))};function et(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.floor(e),n=Math.round((e-r)*60);return t?"".concat(r,".").concat(Math.floor(n/6),"h"):"".concat(r,"시간 ").concat(n,"분")}function er(e){let t=new Date,r=new Date(e);return t.setHours(0,0,0,0),r.setHours(0,0,0,0),r<t}let en=e=>{z(e),Y(e.date),V(e.check_in?(0,l.WU)((0,m.D)(e.check_in),"HH:mm"):""),Q(e.check_out?(0,l.WU)((0,m.D)(e.check_out),"HH:mm"):"")},es=()=>{z(null)},ea=async()=>{if(L)try{I(!0),C(null);let[e,t,r]=K.split("-").map(Number),n=new Date(e,t-1,r),[s,a]=R.split(":").map(Number),l=new Date(n);l.setHours(s,a,0);let i=null;if(Z){let[e,t]=Z.split(":").map(Number);(i=new Date(n)).setHours(e,t,0)}let c=null;if(l&&i){let e=i.getTime()-l.getTime();e<0&&(e+=864e5),c=e/36e5}if(await (0,_.Dg)(L.id,l.toISOString(),i?i.toISOString():null,c,K)){z(null);let e=await (0,_.F8)();if(k(e||[]),D){let t=e.filter(e=>e.date===D);U(t)}if(K!==L.date){E(K);let t=e.filter(e=>e.date===K).sort((e,t)=>{let r=e.check_in?new Date(e.check_in).getTime():0,n=t.check_in?new Date(t.check_in).getTime():0;return r-n});U(t)}}}catch(e){console.error("Error updating entry:",e),C("기록 수정 중 오류가 발생했습니다.")}finally{I(!1)}},el=async e=>{try{if(I(!0),C(null),await (0,_.eh)(e)){let e=await (0,_.F8)();if(k(e||[]),D){let t=e.filter(e=>e.date===D);U(t)}}}catch(e){console.error("Error deleting entry:",e),C("기록 삭제 중 오류가 발생했습니다.")}finally{I(!1)}};return(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"근무 기록 대시보드"}),(0,n.jsx)(a.default,{href:"/timer",className:"bg-primary text-white px-4 py-2 rounded hover:bg-blue-700",children:"출퇴근 기록"})]}),T&&(0,n.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,n.jsx)("span",{className:"ml-3",children:"데이터를 불러오는 중..."})]}),q&&(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,n.jsx)("p",{children:q}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"Supabase 연결 및 환경 변수를 확인해주세요."})]}),!T&&!q&&(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"근무 시간 요약"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"이번 달 총 근무시간"}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:et(S)})]}),(0,n.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"남은 시간"}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:S<100?et(100-S):"0시간 0분"})]})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"오늘 계획 진행률"}),(0,n.jsx)("p",{className:"text-sm font-medium",children:0===F?"0%":"".concat(Math.min(Math.round(H/F*100),100),"% (").concat(et(H)," / ").concat(et(F),")")})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:0===F?(0,n.jsx)("div",{className:"w-0 h-2.5 rounded-full bg-blue-600"}):(0,n.jsx)("div",{className:"h-2.5 rounded-full bg-blue-600",style:{width:"".concat(Math.min(Math.round(H/F*100),100),"%")}})})]})]}),!T&&!q&&(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("button",{onClick:()=>{t((0,i.W)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:"<"}),(0,n.jsx)("h2",{className:"text-xl font-semibold",children:(0,l.WU)(e,"yyyy년 MM월",{locale:y.ko})}),(0,n.jsx)("button",{onClick:()=>{t((0,c.z)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:">"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["일","월","화","수","목","금","토"].map(e=>(0,n.jsx)("div",{className:"text-center font-semibold p-2",children:e},e)),Array.from({length:$}).map((e,t)=>(0,n.jsx)("div",{className:"p-2"},"empty-".concat(t))),P.map(e=>{let t=(0,l.WU)(e,"yyyy-MM-dd"),s=(0,f.b)(e),a=(0,g.i)(e),i=0;r.forEach(e=>{if(!e.check_in||!e.check_out)return;let t=(0,m.D)(e.check_in),r=(0,m.D)(e.check_out);if(t<=a&&r>=s||t<=a&&r<s&&!(0,x.K)(t,r)){let e=t>s?t:s,n=r<a?r:a;if((0,p.A)(n,e)){let t=(0,w.A)(n,e)+(0,b.X)(n,e)%60/60;i+=t}}});let c=N.filter(e=>e.date===t),o=0;c.forEach(e=>{o+=parseFloat(e.planned_hours.toString())}),er(t)&&(c.length>0?o=i:i>0&&(o=i));let d=i>0,u=c.length>0||er(t)&&i>0,y=D===t,_="";return d&&(i>=8?_="bg-green-100":i>=4?_="bg-yellow-100":i>0&&(_="bg-red-100")),(0,n.jsxs)("div",{className:"p-2 min-h-[60px] border ".concat(y?"border-blue-500":"border-gray-200"," ").concat(_," cursor-pointer hover:bg-gray-50"),onClick:()=>ee(t),children:[(0,n.jsx)("div",{className:"font-medium ".concat(6===(0,h.w)(e)?"text-blue-600":0===(0,h.w)(e)?"text-red-600":""),children:(0,l.WU)(e,"d")}),d&&(0,n.jsx)("div",{className:"text-xs mt-1 text-gray-600",children:et(i,!0)}),u&&(0,n.jsx)("div",{className:"text-xs mt-1 text-green-600",children:et(o,!0)})]},t)})]})]}),D&&(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:[(0,l.WU)((0,m.D)(D),"yyyy년 MM월 dd일")," 근무 기록"]}),(0,n.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"총 근무 시간:"}),(0,n.jsx)("span",{className:"text-xl font-bold text-blue-600",children:(()=>{let e=(0,f.b)((0,m.D)(D)),t=(0,g.i)((0,m.D)(D)),n=0;return r.forEach(r=>{if(!r.check_in||!r.check_out)return;let s=(0,m.D)(r.check_in),a=(0,m.D)(r.check_out);if(s<=t&&a>=e||s<=t&&a<e&&!(0,x.K)(s,a)){let r=s>e?s:e,l=a<t?a:t;if((0,p.A)(l,r)){let e=(0,w.A)(l,r)+(0,b.X)(l,r)%60/60;n+=e}}}),et(n)})()})]})}),M.length>0?(0,n.jsx)("div",{className:"overflow-hidden",children:(0,n.jsx)("div",{className:"divide-y divide-gray-200",children:M.map(e=>(0,n.jsx)("div",{className:"relative",children:(null==L?void 0:L.id)===e.id?(0,n.jsxs)("div",{className:"p-4 bg-blue-50",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"날짜"}),(0,n.jsx)("input",{type:"date",value:K,onChange:e=>Y(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"출근 시간"}),(0,n.jsx)("input",{type:"time",value:R,onChange:e=>V(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"퇴근 시간"}),(0,n.jsx)("input",{type:"time",value:Z,onChange:e=>Q(e.target.value),className:"border rounded px-2 py-1 w-full"})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,n.jsx)("button",{onClick:ea,className:"bg-green-500 text-white px-4 py-1 rounded text-sm",children:"저장"}),(0,n.jsx)("button",{onClick:es,className:"bg-gray-500 text-white px-4 py-1 rounded text-sm",children:"취소"})]})]}):(0,n.jsxs)("div",{className:"group overflow-hidden touch-pan-x",children:[(0,n.jsx)("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 text-white flex items-center justify-center w-16 transform translate-x-full group-[.swiped]:translate-x-0 transition-transform duration-200",children:(0,n.jsx)("button",{onClick:()=>el(e.id),className:"w-full h-full flex items-center justify-center",children:"삭제"})}),(0,n.jsxs)("div",{className:"p-4 bg-white flex justify-between items-center transform group-[.swiped]:-translate-x-16 transition-transform duration-200 cursor-pointer",onClick:()=>en(e),onTouchStart:e=>{e.currentTarget.dataset.touchStartX=e.touches[0].clientX.toString()},onTouchMove:e=>{var t,r;let n=parseInt(e.currentTarget.dataset.touchStartX||"0")-e.touches[0].clientX;n>50?null===(t=e.currentTarget.parentElement)||void 0===t||t.classList.add("swiped"):n<-50&&(null===(r=e.currentTarget.parentElement)||void 0===r||r.classList.remove("swiped"))},onTouchEnd:()=>{},children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"font-medium text-sm",children:[e.check_in?(0,l.WU)((0,m.D)(e.check_in),"HH:mm"):"-"," ~ ",e.check_out?(0,l.WU)((0,m.D)(e.check_out),"HH:mm"):"진행중"]})})]}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:e.working_hours?et(e.working_hours,!0):"-"})]})]})},e.id))})}):(0,n.jsx)("p",{className:"text-gray-500 text-center py-4",children:"선택한 날짜의 출퇴근 기록이 없습니다."})]})]})}},8667:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});let n=(0,r(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},3336:function(e,t,r){"use strict";r.d(t,{Av:function(){return s},Dg:function(){return i},F8:function(){return o},eh:function(){return c},lp:function(){return a},se:function(){return l}});var n=r(8667);async function s(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:s}=await n.O.from("time_entries").select("*").eq("date",e).eq("user_id",t.id).order("check_in",{ascending:!0});return s?(console.error("Error fetching time entries:",s),[]):r}async function a(e,t){let{data:{user:r}}=await n.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),null;console.log("출근 기록 생성 - 사용자 ID:",r.id);let{data:s,error:a}=await n.O.from("time_entries").insert([{date:e,check_in:t,check_out:null,working_hours:null,user_id:r.id}]).select();return a?(console.error("Error creating check-in entry:",a),null):s[0]}async function l(e,t,r){let{data:{user:s}}=await n.O.auth.getUser();if(!s)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:a,error:l}=await n.O.from("time_entries").update({check_out:t,working_hours:r}).eq("id",e).eq("user_id",s.id).select();return l?(console.error("Error updating check-out entry:",l),null):a[0]}async function i(e,t,r,s,a){let{data:{user:l}}=await n.O.auth.getUser();if(!l)return console.error("사용자가 로그인되어 있지 않습니다."),null;let i={check_in:t,check_out:r,working_hours:s};a&&(i.date=a);let{data:c,error:o}=await n.O.from("time_entries").update(i).eq("id",e).eq("user_id",l.id).select();return o?(console.error("Error updating time entry:",o),null):c[0]}async function c(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await n.O.from("time_entries").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting time entry:",r),!1)}async function o(){console.log("getAllTimeEntries 함수 호출됨"),console.log("Supabase URL:","https://ijsggnmyblatollrvkhf.supabase.co"),console.log("Supabase Key 설정 여부:",!0);try{let{data:{user:e}}=await n.O.auth.getUser();if(!e)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:t,error:r}=await n.O.from("time_entries").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(r)return console.error("Error fetching all time entries:",r),[];return console.log("가져온 데이터 수:",t?t.length:0),t||[]}catch(e){return console.error("Exception in getAllTimeEntries:",e),[]}}},2674:function(e,t,r){"use strict";r.d(t,{A0:function(){return c},Fs:function(){return l},Nw:function(){return o},Xk:function(){return i},Yx:function(){return s},s_:function(){return a}});var n=r(8667);async function s(e,t){let{data:{user:r}}=await n.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),{success:!1,message:"로그인이 필요합니다."};try{let s=[];for(let a of e){let{data:e,error:l}=await n.O.from("work_schedules").insert([{date:t,start_time:a.start_time,end_time:a.end_time,planned_hours:a.planned_hours,user_id:r.id}]).select();if(l)throw l;s.push(e[0])}return{success:!0,data:s}}catch(e){return console.error("Error copying work schedules:",e),{success:!1,message:e.message||"근무 계획 복사 중 오류가 발생했습니다."}}}async function a(e,t){let{data:{user:r}}=await n.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),[];let s=t.toString().padStart(2,"0"),a="".concat(e,"-").concat(s,"-01"),l=12===t?"".concat(e+1,"-01-01"):"".concat(e,"-").concat((t+1).toString().padStart(2,"0"),"-01"),{data:i,error:c}=await n.O.from("work_schedules").select("*").eq("user_id",r.id).gte("date",a).lt("date",l).order("date",{ascending:!0}).order("start_time",{ascending:!0});return c?(console.error("Error fetching work schedules:",c),[]):i||[]}async function l(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:s}=await n.O.from("work_schedules").select("*").eq("date",e).eq("user_id",t.id).order("start_time",{ascending:!0});return s?(console.error("Error fetching work schedules for date:",s),[]):r||[]}async function i(e,t,r,s){let{data:{user:a}}=await n.O.auth.getUser();if(!a)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await n.O.from("work_schedules").insert([{date:e,start_time:t,end_time:r,planned_hours:s,user_id:a.id}]).select();return i?(console.error("Error creating work schedule:",i),null):l[0]}async function c(e,t,r,s){let{data:{user:a}}=await n.O.auth.getUser();if(!a)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await n.O.from("work_schedules").update({start_time:t,end_time:r,planned_hours:s,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",a.id).select();return i?(console.error("Error updating work schedule:",i),null):l[0]}async function o(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await n.O.from("work_schedules").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting work schedule:",r),!1)}}},function(e){e.O(0,[549,792,493,672,971,69,744],function(){return e(e.s=2481)}),_N_E=e.O()}]);