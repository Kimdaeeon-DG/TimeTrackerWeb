(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2481:function(e,t,r){Promise.resolve().then(r.bind(r,7736))},7736:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var s=r(3827),n=r(4090),l=r(8792),i=r(7835),a=r(9315),c=r(1263),o=r(666),d=r(9686),u=r(3437),m=r(5493),h=r(1825),x=r(1835),g=r(1067),f=r(4970),p=r(6618),b=r(6053),y=r(8855),j=r(7397),w=r(3336);function N(){let[e,t]=(0,n.useState)(new Date),[r,N]=(0,n.useState)([]),[v,k]=(0,n.useState)(0),[_,S]=(0,n.useState)(null),[M,D]=(0,n.useState)([]),[E,U]=(0,n.useState)(!0),[O,I]=(0,n.useState)(null),[T,W]=(0,n.useState)(null),[C,H]=(0,n.useState)(""),[q,J]=(0,n.useState)(""),[X,A]=(0,n.useState)("");(0,n.useEffect)(()=>{console.log("Dashboard 페이지 로드됨"),console.log("Supabase URL:","설정됨"),console.log("Supabase Anon Key:","설정됨")},[]),(0,n.useEffect)(()=>{(async function(){try{U(!0),I(null);let e=await (0,w.F8)();console.log("Loaded entries:",e),N(e||[]);let t=0;e&&e.length>0&&e.forEach(e=>{e.working_hours&&(t+=e.working_hours)}),k(t),U(!1)}catch(e){console.error("Error loading time entries:",e),I("근무 기록을 불러오는 중 오류가 발생했습니다: ".concat(e.message||String(e))),U(!1)}})()},[]);let L=(0,c.N)(e),F=(0,o.V)(e),z=(0,d.D)({start:L,end:F}),K=(0,u.w)(L),R=e=>{S(e),D(r.filter(t=>t.date===e).sort((e,t)=>(e.check_in?new Date(e.check_in).getTime():0)-(t.check_in?new Date(t.check_in).getTime():0)))};function V(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.floor(e),s=Math.round((e-r)*60);return t?"".concat(r,".").concat(Math.floor(s/6),"h"):"".concat(r,"시간 ").concat(s,"분")}let Z=e=>{W(e),H(e.date),J(e.check_in?(0,m.WU)((0,h.D)(e.check_in),"HH:mm"):""),A(e.check_out?(0,m.WU)((0,h.D)(e.check_out),"HH:mm"):"")},Q=()=>{W(null)},Y=async()=>{if(T)try{U(!0),I(null);let[e,t,r]=C.split("-").map(Number),s=new Date(e,t-1,r),[n,l]=q.split(":").map(Number),i=new Date(s);i.setHours(n,l,0);let a=null;if(X){let[e,t]=X.split(":").map(Number);(a=new Date(s)).setHours(e,t,0)}let c=null;if(i&&a){let e=a.getTime()-i.getTime();e<0&&(e+=864e5),c=e/36e5}if(await (0,w.Dg)(T.id,i.toISOString(),a?a.toISOString():null,c,C)){W(null);let e=await (0,w.F8)();if(N(e||[]),_){let t=e.filter(e=>e.date===_);D(t)}if(C!==T.date){S(C);let t=e.filter(e=>e.date===C).sort((e,t)=>{let r=e.check_in?new Date(e.check_in).getTime():0,s=t.check_in?new Date(t.check_in).getTime():0;return r-s});D(t)}}}catch(e){console.error("Error updating entry:",e),I("기록 수정 중 오류가 발생했습니다.")}finally{U(!1)}},B=async e=>{try{if(U(!0),I(null),await (0,w.eh)(e)){let e=await (0,w.F8)();if(N(e||[]),_){let t=e.filter(e=>e.date===_);D(t)}}}catch(e){console.error("Error deleting entry:",e),I("기록 삭제 중 오류가 발생했습니다.")}finally{U(!1)}};return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"근무 기록 대시보드"}),(0,s.jsx)(l.default,{href:"/timer",className:"bg-primary text-white px-4 py-2 rounded hover:bg-blue-700",children:"출퇴근 기록"})]}),E&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,s.jsx)("span",{className:"ml-3",children:"데이터를 불러오는 중..."})]}),O&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,s.jsx)("p",{children:O}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"Supabase 연결 및 환경 변수를 확인해주세요."})]}),!E&&!O&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"근무 시간 요약"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"총 근무 시간"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:V(v)})]}),(0,s.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"이번 달 근무 일수"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[r.filter(t=>t.date.startsWith((0,m.WU)(e,"yyyy-MM"))).length>0?Array.from(new Set(r.filter(t=>t.date.startsWith((0,m.WU)(e,"yyyy-MM"))).map(e=>e.date))).length:0,"일"]})]}),(0,s.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"남은 근무 시간"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:v<80?V(80-v):"0시간 0분"})]})]})]}),!E&&!O&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:()=>{t((0,i.W)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:"<"}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:(0,m.WU)(e,"yyyy년 MM월",{locale:j.ko})}),(0,s.jsx)("button",{onClick:()=>{t((0,a.z)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:">"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["일","월","화","수","목","금","토"].map(e=>(0,s.jsx)("div",{className:"text-center font-semibold p-2",children:e},e)),Array.from({length:K}).map((e,t)=>(0,s.jsx)("div",{className:"p-2"},"empty-".concat(t))),z.map(e=>{let t=(0,m.WU)(e,"yyyy-MM-dd"),n=(0,x.b)(e),l=(0,g.i)(e),i=0;r.forEach(e=>{if(!e.check_in||!e.check_out)return;let t=(0,h.D)(e.check_in),r=(0,h.D)(e.check_out);if(t<=l&&r>=n||t<=l&&r<n&&!(0,f.K)(t,r)){let e=t>n?t:n,s=r<l?r:l;if((0,p.A)(s,e)){let t=(0,b.A)(s,e)+(0,y.X)(s,e)%60/60;i+=t}}});let a=i>0,c=_===t,o="";return a&&(i>=8?o="bg-green-100":i>=4?o="bg-yellow-100":i>0&&(o="bg-red-100")),(0,s.jsxs)("div",{className:"p-2 min-h-[60px] border ".concat(c?"border-blue-500":"border-gray-200"," ").concat(o," cursor-pointer hover:bg-gray-50"),onClick:()=>R(t),children:[(0,s.jsx)("div",{className:"font-medium ".concat(6===(0,u.w)(e)?"text-blue-600":0===(0,u.w)(e)?"text-red-600":""),children:(0,m.WU)(e,"d")}),a&&(0,s.jsx)("div",{className:"text-xs mt-1 text-gray-600",children:V(i,!0)})]},t)})]})]}),M.length>0?(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:[_?(0,m.WU)((0,h.D)(_),"yyyy년 MM월 dd일"):(0,m.WU)(new Date,"yyyy년 MM월 dd일")," 출퇴근 기록"]}),(0,s.jsx)("div",{className:"overflow-hidden",children:(0,s.jsx)("div",{className:"divide-y divide-gray-200",children:M.map(e=>(0,s.jsx)("div",{className:"relative",children:(null==T?void 0:T.id)===e.id?(0,s.jsxs)("div",{className:"p-4 bg-blue-50",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"날짜"}),(0,s.jsx)("input",{type:"date",value:C,onChange:e=>H(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"출근 시간"}),(0,s.jsx)("input",{type:"time",value:q,onChange:e=>J(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"퇴근 시간"}),(0,s.jsx)("input",{type:"time",value:X,onChange:e=>A(e.target.value),className:"border rounded px-2 py-1 w-full"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:Y,className:"bg-green-500 text-white px-4 py-1 rounded text-sm",children:"저장"}),(0,s.jsx)("button",{onClick:Q,className:"bg-gray-500 text-white px-4 py-1 rounded text-sm",children:"취소"})]})]}):(0,s.jsxs)("div",{className:"group overflow-hidden touch-pan-x",children:[(0,s.jsx)("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 text-white flex items-center justify-center w-16 transform translate-x-full group-[.swiped]:translate-x-0 transition-transform duration-200",children:(0,s.jsx)("button",{onClick:()=>B(e.id),className:"w-full h-full flex items-center justify-center",children:"삭제"})}),(0,s.jsxs)("div",{className:"p-4 bg-white flex justify-between items-center transform group-[.swiped]:-translate-x-16 transition-transform duration-200 cursor-pointer",onClick:()=>Z(e),onTouchStart:e=>{e.currentTarget.dataset.touchStartX=e.touches[0].clientX.toString()},onTouchMove:e=>{var t,r;let s=parseInt(e.currentTarget.dataset.touchStartX||"0")-e.touches[0].clientX;s>50?null===(t=e.currentTarget.parentElement)||void 0===t||t.classList.add("swiped"):s<-50&&(null===(r=e.currentTarget.parentElement)||void 0===r||r.classList.remove("swiped"))},onTouchEnd:()=>{},children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"font-medium text-sm",children:[e.check_in?(0,m.WU)((0,h.D)(e.check_in),"HH:mm"):"-"," ~ ",e.check_out?(0,m.WU)((0,h.D)(e.check_out),"HH:mm"):"진행중"]})})]}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:e.working_hours?V(e.working_hours,!0):"-"})]})]})},e.id))})})]}):_&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:[_?(0,m.WU)((0,h.D)(_),"yyyy년 MM월 dd일"):(0,m.WU)(new Date,"yyyy년 MM월 dd일")," 출퇴근 기록"]}),(0,s.jsx)("p",{className:"text-gray-500 text-center py-4",children:"선택한 날짜의 출퇴근 기록이 없습니다."})]})]})}},8667:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},3336:function(e,t,r){"use strict";r.d(t,{Av:function(){return n},Dg:function(){return a},F8:function(){return o},eh:function(){return c},lp:function(){return l},se:function(){return i}});var s=r(8667);async function n(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:n}=await s.O.from("time_entries").select("*").eq("date",e).eq("user_id",t.id).order("check_in",{ascending:!0});return n?(console.error("Error fetching time entries:",n),[]):r}async function l(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),null;console.log("출근 기록 생성 - 사용자 ID:",r.id);let{data:n,error:l}=await s.O.from("time_entries").insert([{date:e,check_in:t,check_out:null,working_hours:null,user_id:r.id}]).select();return l?(console.error("Error creating check-in entry:",l),null):n[0]}async function i(e,t,r){let{data:{user:n}}=await s.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await s.O.from("time_entries").update({check_out:t,working_hours:r}).eq("id",e).eq("user_id",n.id).select();return i?(console.error("Error updating check-out entry:",i),null):l[0]}async function a(e,t,r,n,l){let{data:{user:i}}=await s.O.auth.getUser();if(!i)return console.error("사용자가 로그인되어 있지 않습니다."),null;let a={check_in:t,check_out:r,working_hours:n};l&&(a.date=l);let{data:c,error:o}=await s.O.from("time_entries").update(a).eq("id",e).eq("user_id",i.id).select();return o?(console.error("Error updating time entry:",o),null):c[0]}async function c(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await s.O.from("time_entries").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting time entry:",r),!1)}async function o(){console.log("getAllTimeEntries 함수 호출됨"),console.log("Supabase URL:","https://ijsggnmyblatollrvkhf.supabase.co"),console.log("Supabase Key 설정 여부:",!0);try{let{data:{user:e}}=await s.O.auth.getUser();if(!e)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:t,error:r}=await s.O.from("time_entries").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(r)return console.error("Error fetching all time entries:",r),[];return console.log("가져온 데이터 수:",t?t.length:0),t||[]}catch(e){return console.error("Exception in getAllTimeEntries:",e),[]}}}},function(e){e.O(0,[549,792,493,672,971,69,744],function(){return e(e.s=2481)}),_N_E=e.O()}]);