(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{1086:function(e,t,r){Promise.resolve().then(r.bind(r,7546))},7546:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(3827),a=r(4090),n=r(7835),l=r(9315),i=r(1263),c=r(666),d=r(9686),o=r(3437),u=r(5493),m=r(1825),h=r(7397),x=r(2674),g=r(8009);function p(){let[e,t]=(0,a.useState)(new Date),[r,p]=(0,a.useState)([]),[f,b]=(0,a.useState)(null),[y,j]=(0,a.useState)([]),[N,w]=(0,a.useState)(!0),[v,_]=(0,a.useState)(null),[k,S]=(0,a.useState)(0),[O,E]=(0,a.useState)(!1),[M,I]=(0,a.useState)(null),[C,F]=(0,a.useState)(""),[U,Z]=(0,a.useState)(""),[J,P]=(0,a.useState)(0);(0,a.useEffect)(()=>{console.log("Schedule 페이지 로드됨")},[]),(0,a.useEffect)(()=>{(async function(){try{w(!0),_(null);let t=await (0,x.s_)(e.getFullYear(),e.getMonth()+1);p(t||[]);let r=0;t.forEach(e=>{r+=parseFloat(e.planned_hours.toString())}),S(r),w(!1)}catch(e){console.error("Error loading work schedules:",e),_("근무 계획을 불러오는 중 오류가 발생했습니다: ".concat(e.message||String(e))),w(!1)}})()},[e]);let q=(0,i.N)(e),X=(0,c.V)(e),D=(0,d.D)({start:q,end:X}),W=(0,o.w)(q),Y=async e=>{b(e);try{let t=await (0,x.Fs)(e);j(t),V()}catch(e){console.error("Error fetching schedules for date:",e),g.ZP.error("해당 날짜의 근무 계획을 불러오는데 실패했습니다.")}};function A(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.floor(e),s=Math.round((e-r)*60);return t?"".concat(r,".").concat(Math.floor(s/6),"h"):"".concat(r,"시간 ").concat(s,"분")}let z=e=>{E(!1),I(e),F(e.start_time.substring(0,5)),Z(e.end_time.substring(0,5)),P(e.planned_hours)},V=()=>{E(!1),I(null),F(""),Z(""),P(0)},H=(e,t)=>{if(!e||!t)return;let[r,s]=e.split(":").map(Number),[a,n]=t.split(":").map(Number),l=60*a+n-(60*r+s);l<0&&(l+=1440),P(parseFloat((l/60).toFixed(2)))},Q=async()=>{if(!f||!C||!U){g.ZP.error("모든 필드를 입력해주세요.");return}try{w(!0),M?await (0,x.A0)(M.id,C,U,J)&&g.ZP.success("근무 계획이 수정되었습니다."):await (0,x.Xk)(f,C,U,J)&&(g.ZP.success("근무 계획이 추가되었습니다."),F("09:00"),Z("18:00"),H("09:00","18:00"));let t=await (0,x.s_)(e.getFullYear(),e.getMonth()+1);if(p(t||[]),f){let e=await (0,x.Fs)(f);j(e)}M&&V()}catch(e){console.error("Error saving work schedule:",e),g.ZP.error("근무 계획 저장 중 오류가 발생했습니다.")}finally{w(!1)}},T=async t=>{try{if(w(!0),await (0,x.Nw)(t)){g.ZP.success("근무 계획이 삭제되었습니다.");let r=await (0,x.s_)(e.getFullYear(),e.getMonth()+1);if(p(r||[]),f){let e=await (0,x.Fs)(f);j(e)}M&&M.id===t&&V()}}catch(e){console.error("Error deleting work schedule:",e),g.ZP.error("근무 계획 삭제 중 오류가 발생했습니다.")}finally{w(!1)}};return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)(g.x7,{position:"top-right"}),(0,s.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"근무 계획"})}),N&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,s.jsx)("span",{className:"ml-3",children:"데이터를 불러오는 중..."})]}),v&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,s.jsx)("p",{children:v}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"Supabase 연결 및 환경 변수를 확인해주세요."})]}),!N&&!v&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"근무 계획 요약"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"이번 달 계획 근무 시간"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:A(k)})]}),(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"이번 달 계획 근무 일수"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[Array.from(new Set(r.map(e=>e.date))).length,"일"]})]})]})]}),!N&&!v&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:()=>{t((0,n.W)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:"<"}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:(0,u.WU)(e,"yyyy년 MM월",{locale:h.ko})}),(0,s.jsx)("button",{onClick:()=>{t((0,l.z)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:">"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["일","월","화","수","목","금","토"].map((e,t)=>(0,s.jsx)("div",{className:"text-center font-semibold p-2 ".concat(0===t?"text-red-600":6===t?"text-blue-600":""),children:e},e)),Array.from({length:W}).map((e,t)=>(0,s.jsx)("div",{className:"p-2 min-h-[60px]"},"empty-".concat(t))),D.map(e=>{let t=(0,u.WU)(e,"yyyy-MM-dd"),a=r.filter(e=>e.date===t),n=0;a.forEach(e=>{n+=parseFloat(e.planned_hours.toString())});let l=a.length>0,i=f===t;return(0,s.jsxs)("div",{className:"p-2 min-h-[60px] border ".concat(i?"border-blue-500":"border-gray-200"," cursor-pointer hover:bg-gray-50"),onClick:()=>Y(t),children:[(0,s.jsx)("div",{className:"font-medium ".concat(6===(0,o.w)(e)?"text-blue-600":0===(0,o.w)(e)?"text-red-600":""),children:(0,u.WU)(e,"d")}),l&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)("span",{className:"text-green-600 text-sm font-medium",children:A(n,!0)})})]},t)})]})]}),f&&!N&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:[(0,u.WU)((0,m.D)(f),"yyyy년 MM월 dd일")," 근무 계획"]}),(0,s.jsx)("button",{onClick:()=>{E(!0),I(null),F("09:00"),Z("18:00"),H("09:00","18:00")},className:"bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600",children:"+ 계획 추가"})]}),(O||M)&&(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[(0,s.jsx)("h3",{className:"font-medium mb-3",children:M?"근무 계획 수정":"새 근무 계획 추가"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),(0,s.jsx)("input",{type:"time",value:C,onChange:e=>{let t=e.target.value;F(t),H(t,U)},className:"w-full p-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),(0,s.jsx)("input",{type:"time",value:U,onChange:e=>{let t=e.target.value;Z(t),H(C,t)},className:"w-full p-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"계획 시간"}),(0,s.jsx)("div",{className:"p-2 border rounded bg-gray-100",children:A(J)})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:V,className:"px-3 py-1 border rounded hover:bg-gray-100",children:"취소"}),(0,s.jsx)("button",{onClick:Q,className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"저장"})]})]}),y.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"시작 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종료 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"계획 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.start_time.substring(0,5)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.end_time.substring(0,5)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-green-600",children:A(e.planned_hours)}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>z(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"수정"}),(0,s.jsx)("button",{onClick:()=>T(e.id),className:"text-red-600 hover:text-red-900",children:"삭제"})]})]},e.id))})]})}):(0,s.jsx)("div",{className:"text-center py-6 text-gray-500",children:O?"새 근무 계획을 추가해주세요.":"이 날짜에 등록된 근무 계획이 없습니다. 계획 추가 버튼을 클릭하여 추가해주세요."})]})]})}},8667:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},2674:function(e,t,r){"use strict";r.d(t,{A0:function(){return i},Fs:function(){return n},Nw:function(){return c},Xk:function(){return l},s_:function(){return a}});var s=r(8667);async function a(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),[];let a=t.toString().padStart(2,"0"),n="".concat(e,"-").concat(a,"-01"),l=12===t?"".concat(e+1,"-01-01"):"".concat(e,"-").concat((t+1).toString().padStart(2,"0"),"-01"),{data:i,error:c}=await s.O.from("work_schedules").select("*").eq("user_id",r.id).gte("date",n).lt("date",l).order("date",{ascending:!0}).order("start_time",{ascending:!0});return c?(console.error("Error fetching work schedules:",c),[]):i||[]}async function n(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:a}=await s.O.from("work_schedules").select("*").eq("date",e).eq("user_id",t.id).order("start_time",{ascending:!0});return a?(console.error("Error fetching work schedules for date:",a),[]):r||[]}async function l(e,t,r,a){let{data:{user:n}}=await s.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await s.O.from("work_schedules").insert([{date:e,start_time:t,end_time:r,planned_hours:a,user_id:n.id}]).select();return i?(console.error("Error creating work schedule:",i),null):l[0]}async function i(e,t,r,a){let{data:{user:n}}=await s.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await s.O.from("work_schedules").update({start_time:t,end_time:r,planned_hours:a,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",n.id).select();return i?(console.error("Error updating work schedule:",i),null):l[0]}async function c(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await s.O.from("work_schedules").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting work schedule:",r),!1)}}},function(e){e.O(0,[549,493,400,9,971,69,744],function(){return e(e.s=1086)}),_N_E=e.O()}]);