(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2481:function(e,t,r){Promise.resolve().then(r.bind(r,5422))},5422:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var n=r(3827),s=r(4090),a=r(8792),l=r(5493),i=r(7835),o=r(9315),c=r(1263),d=r(666),u=r(9686),h=r(3437),m=r(1825),f=r(1835),g=r(2328);function x(e){return t=>{let r=(e?Math[e]:Math.trunc)(t);return 0===r?0:r}}var p=r(1562);function w(e,t){return+(0,g.Q)(e)-+(0,g.Q)(t)}var y=r(7397),b=r(3336),_=r(2674);function j(){let[e,t]=(0,s.useState)(new Date),[r,j]=(0,s.useState)([]),[k,v]=(0,s.useState)([]),[N,S]=(0,s.useState)(0),[M,E]=(0,s.useState)(null),[O,D]=(0,s.useState)([]),[U,T]=(0,s.useState)(!0),[I,W]=(0,s.useState)(null),[q,C]=(0,s.useState)(null),[F,H]=(0,s.useState)(""),[J,X]=(0,s.useState)(""),[L,Q]=(0,s.useState)("");(0,s.useEffect)(()=>{console.log("Dashboard 페이지 로드됨"),console.log("Supabase URL:","설정됨"),console.log("Supabase Anon Key:","설정됨")},[]),(0,s.useEffect)(()=>{(async function(){try{T(!0),W(null);let t=await (0,b.F8)();console.log("Loaded entries:",t),j(t||[]);let r=await (0,_.s_)(e.getFullYear(),e.getMonth()+1);console.log("Loaded work schedules:",r),v(r||[]);let n=(0,l.WU)(e,"yyyy-MM"),s=t?t.filter(e=>e.date.startsWith(n)):[],a=0;s.length>0&&s.forEach(e=>{e.working_hours&&(a+=e.working_hours)}),S(a),T(!1)}catch(e){console.error("Error loading data:",e),W("데이터를 불러오는 중 오류가 발생했습니다: ".concat(e.message||String(e))),T(!1)}})()},[e]);let A=(0,c.N)(e),z=(0,d.V)(e),Y=(0,u.D)({start:A,end:z}),R=(0,h.w)(A),V=e=>{E(e),D(r.filter(t=>t.date===e).sort((e,t)=>(e.check_in?new Date(e.check_in).getTime():0)-(t.check_in?new Date(t.check_in).getTime():0)))};function Z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.floor(e),n=Math.round((e-r)*60);return t?"".concat(r,".").concat(Math.floor(n/6),"h"):"".concat(r,"시간 ").concat(n,"분")}let K=e=>{C(e),H(e.date),X(e.check_in?(0,l.WU)((0,m.D)(e.check_in),"HH:mm"):""),Q(e.check_out?(0,l.WU)((0,m.D)(e.check_out),"HH:mm"):"")},B=()=>{C(null)},G=async()=>{if(q)try{T(!0),W(null);let[e,t,r]=F.split("-").map(Number),n=new Date(e,t-1,r),[s,a]=J.split(":").map(Number),l=new Date(n);l.setHours(s,a,0);let i=null;if(L){let[e,t]=L.split(":").map(Number);(i=new Date(n)).setHours(e,t,0)}let o=null;if(l&&i){let e=i.getTime()-l.getTime();e<0&&(e+=864e5),o=e/36e5}if(await (0,b.Dg)(q.id,l.toISOString(),i?i.toISOString():null,o,F)){C(null);let e=await (0,b.F8)();if(j(e||[]),M){let t=e.filter(e=>e.date===M);D(t)}if(F!==q.date){E(F);let t=e.filter(e=>e.date===F).sort((e,t)=>{let r=e.check_in?new Date(e.check_in).getTime():0,n=t.check_in?new Date(t.check_in).getTime():0;return r-n});D(t)}}}catch(e){console.error("Error updating entry:",e),W("기록 수정 중 오류가 발생했습니다.")}finally{T(!1)}},P=async e=>{try{if(T(!0),W(null),await (0,b.eh)(e)){let e=await (0,b.F8)();if(j(e||[]),M){let t=e.filter(e=>e.date===M);D(t)}}}catch(e){console.error("Error deleting entry:",e),W("기록 삭제 중 오류가 발생했습니다.")}finally{T(!1)}};return(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"근무 기록 대시보드"}),(0,n.jsx)(a.default,{href:"/timer",className:"bg-primary text-white px-4 py-2 rounded hover:bg-blue-700",children:"출퇴근 기록"})]}),U&&(0,n.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,n.jsx)("span",{className:"ml-3",children:"데이터를 불러오는 중..."})]}),I&&(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,n.jsx)("p",{children:I}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"Supabase 연결 및 환경 변수를 확인해주세요."})]}),!U&&!I&&(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"근무 시간 요약"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"총 근무 시간"}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:Z(N)})]}),(0,n.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"남은 근무 시간"}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:N<100?Z(100-N):"0시간 0분"})]})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,n.jsx)("p",{className:"text-gray-600",children:"오늘 계획 진행률"}),(0,n.jsx)("p",{className:"text-sm font-medium",children:(()=>{let e=new Date,t=(0,l.WU)(e,"yyyy-MM-dd"),n=k.filter(e=>e.date===t),s=0;n.forEach(e=>{s+=parseFloat(e.planned_hours.toString())});let a=r.filter(e=>e.date===t),i=0;if(a.forEach(e=>{if(null!==e.working_hours)i+=parseFloat(e.working_hours.toString());else if(e.check_in&&!e.check_out){let t=new Date(e.check_in),r=(new Date().getTime()-t.getTime())/36e5;i+=r}}),0===s)return"0%";let o=Math.min(Math.round(i/s*100),100);return"".concat(o,"% (").concat(Z(i)," / ").concat(Z(s),")")})()})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(()=>{let e=new Date,t=(0,l.WU)(e,"yyyy-MM-dd"),s=k.filter(e=>e.date===t),a=0;s.forEach(e=>{a+=parseFloat(e.planned_hours.toString())});let i=r.filter(e=>e.date===t),o=0;if(i.forEach(e=>{if(null!==e.working_hours)o+=parseFloat(e.working_hours.toString());else if(e.check_in&&!e.check_out){let t=new Date(e.check_in),r=(new Date().getTime()-t.getTime())/36e5;o+=r}}),0===a)return(0,n.jsx)("div",{className:"w-0 h-2.5 rounded-full bg-blue-600"});let c=Math.min(Math.round(o/a*100),100);return(0,n.jsx)("div",{className:"h-2.5 rounded-full bg-blue-600",style:{width:"".concat(c,"%")}})})()})]})]}),!U&&!I&&(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("button",{onClick:()=>{t((0,i.W)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:"<"}),(0,n.jsx)("h2",{className:"text-xl font-semibold",children:(0,l.WU)(e,"yyyy년 MM월",{locale:y.ko})}),(0,n.jsx)("button",{onClick:()=>{t((0,o.z)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:">"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["일","월","화","수","목","금","토"].map(e=>(0,n.jsx)("div",{className:"text-center font-semibold p-2",children:e},e)),Array.from({length:R}).map((e,t)=>(0,n.jsx)("div",{className:"p-2"},"empty-".concat(t))),Y.map(e=>{let t=(0,l.WU)(e,"yyyy-MM-dd"),s=(0,f.b)(e),a=function(e){let t=(0,g.Q)(e);return t.setHours(23,59,59,999),t}(e),i=0;r.forEach(e=>{if(!e.check_in||!e.check_out)return;let t=(0,m.D)(e.check_in),r=(0,m.D)(e.check_out);if(t<=a&&r>=s||t<=a&&r<s&&+(0,f.b)(t)!=+(0,f.b)(r)){let e=t>s?t:s,n=r<a?r:a;if(function(e,t){let r=(0,g.Q)(e),n=(0,g.Q)(t);return r.getTime()>n.getTime()}(n,e)){let t=function(e,t,r){let n=w(e,t)/p.vh;return x(null==r?void 0:r.roundingMethod)(n)}(n,e)+function(e,t,r){let n=w(e,t)/p.yJ;return x(null==r?void 0:r.roundingMethod)(n)}(n,e)%60/60;i+=t}}});let o=k.filter(e=>e.date===t),c=0;o.forEach(e=>{c+=parseFloat(e.planned_hours.toString())});let d=i>0,u=o.length>0,y=M===t,b="";return d&&(i>=8?b="bg-green-100":i>=4?b="bg-yellow-100":i>0&&(b="bg-red-100")),(0,n.jsxs)("div",{className:"p-2 min-h-[60px] border ".concat(y?"border-blue-500":"border-gray-200"," ").concat(b," cursor-pointer hover:bg-gray-50"),onClick:()=>V(t),children:[(0,n.jsx)("div",{className:"font-medium ".concat(6===(0,h.w)(e)?"text-blue-600":0===(0,h.w)(e)?"text-red-600":""),children:(0,l.WU)(e,"d")}),d&&(0,n.jsx)("div",{className:"text-xs mt-1 text-gray-600",children:Z(i,!0)}),u&&(0,n.jsx)("div",{className:"text-xs mt-1 text-green-600",children:Z(c,!0)})]},t)})]})]}),O.length>0?(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:[M?(0,l.WU)((0,m.D)(M),"yyyy년 MM월 dd일"):(0,l.WU)(new Date,"yyyy년 MM월 dd일")," 출퇴근 기록"]}),(0,n.jsx)("div",{className:"overflow-hidden",children:(0,n.jsx)("div",{className:"divide-y divide-gray-200",children:O.map(e=>(0,n.jsx)("div",{className:"relative",children:(null==q?void 0:q.id)===e.id?(0,n.jsxs)("div",{className:"p-4 bg-blue-50",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"날짜"}),(0,n.jsx)("input",{type:"date",value:F,onChange:e=>H(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"출근 시간"}),(0,n.jsx)("input",{type:"time",value:J,onChange:e=>X(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"퇴근 시간"}),(0,n.jsx)("input",{type:"time",value:L,onChange:e=>Q(e.target.value),className:"border rounded px-2 py-1 w-full"})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,n.jsx)("button",{onClick:G,className:"bg-green-500 text-white px-4 py-1 rounded text-sm",children:"저장"}),(0,n.jsx)("button",{onClick:B,className:"bg-gray-500 text-white px-4 py-1 rounded text-sm",children:"취소"})]})]}):(0,n.jsxs)("div",{className:"group overflow-hidden touch-pan-x",children:[(0,n.jsx)("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 text-white flex items-center justify-center w-16 transform translate-x-full group-[.swiped]:translate-x-0 transition-transform duration-200",children:(0,n.jsx)("button",{onClick:()=>P(e.id),className:"w-full h-full flex items-center justify-center",children:"삭제"})}),(0,n.jsxs)("div",{className:"p-4 bg-white flex justify-between items-center transform group-[.swiped]:-translate-x-16 transition-transform duration-200 cursor-pointer",onClick:()=>K(e),onTouchStart:e=>{e.currentTarget.dataset.touchStartX=e.touches[0].clientX.toString()},onTouchMove:e=>{var t,r;let n=parseInt(e.currentTarget.dataset.touchStartX||"0")-e.touches[0].clientX;n>50?null===(t=e.currentTarget.parentElement)||void 0===t||t.classList.add("swiped"):n<-50&&(null===(r=e.currentTarget.parentElement)||void 0===r||r.classList.remove("swiped"))},onTouchEnd:()=>{},children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"font-medium text-sm",children:[e.check_in?(0,l.WU)((0,m.D)(e.check_in),"HH:mm"):"-"," ~ ",e.check_out?(0,l.WU)((0,m.D)(e.check_out),"HH:mm"):"진행중"]})})]}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:e.working_hours?Z(e.working_hours,!0):"-"})]})]})},e.id))})})]}):M&&(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:[M?(0,l.WU)((0,m.D)(M),"yyyy년 MM월 dd일"):(0,l.WU)(new Date,"yyyy년 MM월 dd일")," 출퇴근 기록"]}),(0,n.jsx)("p",{className:"text-gray-500 text-center py-4",children:"선택한 날짜의 출퇴근 기록이 없습니다."})]})]})}},8667:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});let n=(0,r(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},3336:function(e,t,r){"use strict";r.d(t,{Av:function(){return s},Dg:function(){return i},F8:function(){return c},eh:function(){return o},lp:function(){return a},se:function(){return l}});var n=r(8667);async function s(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:s}=await n.O.from("time_entries").select("*").eq("date",e).eq("user_id",t.id).order("check_in",{ascending:!0});return s?(console.error("Error fetching time entries:",s),[]):r}async function a(e,t){let{data:{user:r}}=await n.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),null;console.log("출근 기록 생성 - 사용자 ID:",r.id);let{data:s,error:a}=await n.O.from("time_entries").insert([{date:e,check_in:t,check_out:null,working_hours:null,user_id:r.id}]).select();return a?(console.error("Error creating check-in entry:",a),null):s[0]}async function l(e,t,r){let{data:{user:s}}=await n.O.auth.getUser();if(!s)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:a,error:l}=await n.O.from("time_entries").update({check_out:t,working_hours:r}).eq("id",e).eq("user_id",s.id).select();return l?(console.error("Error updating check-out entry:",l),null):a[0]}async function i(e,t,r,s,a){let{data:{user:l}}=await n.O.auth.getUser();if(!l)return console.error("사용자가 로그인되어 있지 않습니다."),null;let i={check_in:t,check_out:r,working_hours:s};a&&(i.date=a);let{data:o,error:c}=await n.O.from("time_entries").update(i).eq("id",e).eq("user_id",l.id).select();return c?(console.error("Error updating time entry:",c),null):o[0]}async function o(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await n.O.from("time_entries").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting time entry:",r),!1)}async function c(){console.log("getAllTimeEntries 함수 호출됨"),console.log("Supabase URL:","https://ijsggnmyblatollrvkhf.supabase.co"),console.log("Supabase Key 설정 여부:",!0);try{let{data:{user:e}}=await n.O.auth.getUser();if(!e)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:t,error:r}=await n.O.from("time_entries").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(r)return console.error("Error fetching all time entries:",r),[];return console.log("가져온 데이터 수:",t?t.length:0),t||[]}catch(e){return console.error("Exception in getAllTimeEntries:",e),[]}}},2674:function(e,t,r){"use strict";r.d(t,{A0:function(){return o},Fs:function(){return l},Nw:function(){return c},Xk:function(){return i},Yx:function(){return s},s_:function(){return a}});var n=r(8667);async function s(e,t){let{data:{user:r}}=await n.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),{success:!1,message:"로그인이 필요합니다."};try{let s=[];for(let a of e){let{data:e,error:l}=await n.O.from("work_schedules").insert([{date:t,start_time:a.start_time,end_time:a.end_time,planned_hours:a.planned_hours,user_id:r.id}]).select();if(l)throw l;s.push(e[0])}return{success:!0,data:s}}catch(e){return console.error("Error copying work schedules:",e),{success:!1,message:e.message||"근무 계획 복사 중 오류가 발생했습니다."}}}async function a(e,t){let{data:{user:r}}=await n.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),[];let s=t.toString().padStart(2,"0"),a="".concat(e,"-").concat(s,"-01"),l=12===t?"".concat(e+1,"-01-01"):"".concat(e,"-").concat((t+1).toString().padStart(2,"0"),"-01"),{data:i,error:o}=await n.O.from("work_schedules").select("*").eq("user_id",r.id).gte("date",a).lt("date",l).order("date",{ascending:!0}).order("start_time",{ascending:!0});return o?(console.error("Error fetching work schedules:",o),[]):i||[]}async function l(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:s}=await n.O.from("work_schedules").select("*").eq("date",e).eq("user_id",t.id).order("start_time",{ascending:!0});return s?(console.error("Error fetching work schedules for date:",s),[]):r||[]}async function i(e,t,r,s){let{data:{user:a}}=await n.O.auth.getUser();if(!a)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await n.O.from("work_schedules").insert([{date:e,start_time:t,end_time:r,planned_hours:s,user_id:a.id}]).select();return i?(console.error("Error creating work schedule:",i),null):l[0]}async function o(e,t,r,s){let{data:{user:a}}=await n.O.auth.getUser();if(!a)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:i}=await n.O.from("work_schedules").update({start_time:t,end_time:r,planned_hours:s,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",a.id).select();return i?(console.error("Error updating work schedule:",i),null):l[0]}async function c(e){let{data:{user:t}}=await n.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await n.O.from("work_schedules").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting work schedule:",r),!1)}}},function(e){e.O(0,[549,792,493,400,971,69,744],function(){return e(e.s=2481)}),_N_E=e.O()}]);