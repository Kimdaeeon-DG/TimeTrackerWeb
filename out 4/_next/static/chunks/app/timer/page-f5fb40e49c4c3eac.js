(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{8647:function(e,t,n){Promise.resolve().then(n.bind(n,6189))},6189:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(3827),l=n(4090),i=n(8792),s=n(5493),a=n(1825),o=n(3336);function c(){let[e,t]=(0,l.useState)(!1),[n,c]=(0,l.useState)(null),[u,d]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[g,f]=(0,l.useState)([]),[x,y]=(0,l.useState)(null),[p,w]=(0,l.useState)(""),[N,b]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[k,D]=(0,l.useState)(0),[_,S]=(0,l.useState)(null),[T,I]=(0,l.useState)(!1),[U,C]=(0,l.useState)(null);(0,l.useEffect)(()=>{J()},[]);let[E,O]=(0,l.useState)(null),[M,H]=(0,l.useState)(!1);(0,l.useEffect)(()=>{H(!0),O(new Date);let e=setInterval(()=>{O(new Date)},1e3);return()=>clearInterval(e)},[]);let J=async()=>{I(!0),C(null);try{console.log("기록 불러오기 시작...");let e=(0,s.WU)(new Date,"yyyy-MM-dd");console.log("오늘 날짜:",e);let n=await (0,o.Av)(e);console.log("불러온 기록:",n),f(n);let r=0;if(n&&n.length>0&&(r=n.reduce((e,t)=>{if(null!==t.working_hours)return e+t.working_hours;if(t.check_in&&!t.check_out){let n=new Date(t.check_in),r=(new Date().getTime()-n.getTime())/36e5;return e+r}return e},0)),D(r),n&&n.length>0){let e=n[n.length-1];console.log("마지막 기록:",e),e&&e.check_in&&!e.check_out?(console.log("출근 상태 감지됨"),t(!0),c(new Date(e.check_in))):(console.log("출근 상태 아님"),t(!1))}else console.log("오늘 기록 없음"),t(!1)}catch(e){console.error("Error loading today's records:",e),C("기록을 불러오는 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}finally{console.log("기록 불러오기 완료"),I(!1)}},q=async()=>{try{I(!0),C(null),console.log("출근 처리 시작...");let e=new Date,n=(0,s.WU)(e,"yyyy-MM-dd");console.log("출근 시간:",e.toISOString());let r=await (0,o.lp)(n,e.toISOString());console.log("생성된 출근 기록:",r),r?(t(!0),c(e),d(null),h(null),console.log("출근 처리 성공, 기록 다시 불러오기"),await J()):C("출근 기록 생성에 실패했습니다.")}catch(e){console.error("Error checking in:",e),C("출근 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}finally{console.log("출근 처리 완료"),I(!1)}},z=async()=>{if(n)try{I(!0),C(null);let e=new Date,r=(e.getTime()-n.getTime())/36e5,l=Math.floor(r),i="".concat(l,"시간 ").concat(Math.round((r-l)*60),"분");if(g.length>0){let n=g[g.length-1];await (0,o.se)(n.id,e.toISOString(),r)&&(t(!1),d(e),h(i),J())}}catch(e){console.error("Error checking out:",e),C("퇴근 처리 중 오류가 발생했습니다.")}finally{I(!1)}},W=e=>{y(e),w(e.date),b(e.check_in?(0,s.WU)((0,a.D)(e.check_in),"HH:mm"):""),j(e.check_out?(0,s.WU)((0,a.D)(e.check_out),"HH:mm"):"")},Z=()=>{y(null)},F=async()=>{if(x)try{I(!0),C(null);let[e,t,n]=p.split("-").map(Number),r=new Date(e,t-1,n),[l,i]=N.split(":").map(Number),s=new Date(r);s.setHours(l,i,0);let a=null;if(v){let[e,t]=v.split(":").map(Number);(a=new Date(r)).setHours(e,t,0)}let c=null;if(s&&a){let e=a.getTime()-s.getTime();e<0&&(e+=864e5),c=e/36e5}await (0,o.Dg)(x.id,s.toISOString(),a?a.toISOString():null,c,p)&&(y(null),J())}catch(e){console.error("Error updating entry:",e),C("기록 수정 중 오류가 발생했습니다.")}finally{I(!1)}},X=async e=>{try{I(!0),C(null),await (0,o.eh)(e)&&J()}catch(e){console.error("Error deleting entry:",e),C("기록 삭제 중 오류가 발생했습니다.")}finally{I(!1)}},Y=e=>{if(null===e)return"-";let t=Math.floor(e);return"".concat(t,"시간 ").concat(Math.round((e-t)*60),"분")},[A,$]=(0,l.useState)(null),[R,V]=(0,l.useState)(null),L=(e,t)=>{$(e.targetTouches[0].clientX),V(null)},Q=(e,t)=>{V(e.targetTouches[0].clientX),A&&R&&A-R>50?S(t):A&&R&&R-A>50&&S(null)},B=()=>{A&&R&&($(null),V(null))};return(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"출퇴근 기록"}),(0,r.jsx)(i.default,{href:"/dashboard",className:"bg-primary text-white px-4 py-2 rounded hover:bg-blue-700",children:"대시보드로 이동"})]}),T&&(0,r.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6 text-center",children:(0,r.jsx)("p",{className:"text-blue-700",children:"기록을 불러오는 중..."})}),U&&(0,r.jsx)("div",{className:"bg-red-50 p-4 rounded-lg mb-6",children:(0,r.jsx)("p",{className:"text-red-700",children:U})}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center bg-white shadow rounded-lg p-8 mb-6",children:[(0,r.jsx)("div",{className:"text-xl mb-6",children:M?(0,s.WU)(E||new Date,"yyyy년 MM월 dd일"):""}),(0,r.jsx)("div",{className:"text-4xl font-mono mb-6",children:M?(0,s.WU)(E||new Date,"HH:mm:ss"):""}),(0,r.jsx)("div",{className:"flex space-x-4",children:e?(0,r.jsx)("button",{className:"bg-red-500 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-red-600",onClick:z,disabled:T,children:"퇴근하기"}):(0,r.jsx)("button",{className:"bg-green-500 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-green-600",onClick:q,disabled:T,children:"출근하기"})})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"오늘의 출퇴근 기록"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["총 근무시간: ",Y(k)]}),T?(0,r.jsx)("p",{className:"text-center py-4",children:"기록을 불러오는 중..."}):g.length>0?(0,r.jsx)("div",{className:"overflow-hidden",children:(0,r.jsx)("div",{className:"divide-y divide-gray-200",children:g.map(e=>(0,r.jsx)("div",{className:"relative",children:(null==x?void 0:x.id)===e.id?(0,r.jsxs)("div",{className:"p-4 bg-blue-50",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"날짜"}),(0,r.jsx)("input",{type:"date",value:p,onChange:e=>w(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"출근 시간"}),(0,r.jsx)("input",{type:"time",value:N,onChange:e=>b(e.target.value),className:"border rounded px-2 py-1 w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"퇴근 시간"}),(0,r.jsx)("input",{type:"time",value:v,onChange:e=>j(e.target.value),className:"border rounded px-2 py-1 w-full"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)("button",{onClick:F,className:"bg-green-500 text-white px-4 py-1 rounded text-sm",children:"저장"}),(0,r.jsx)("button",{onClick:Z,className:"bg-gray-500 text-white px-4 py-1 rounded text-sm",children:"취소"})]})]}):(0,r.jsxs)("div",{className:"relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute right-0 top-0 bottom-0 bg-red-500 text-white flex items-center justify-center w-16",children:(0,r.jsx)("button",{onClick:()=>X(e.id),className:"w-full h-full flex items-center justify-center",children:"삭제"})}),(0,r.jsxs)("div",{className:"p-4 bg-white flex justify-between items-center cursor-pointer transform transition-transform duration-200 ".concat(_===e.id?"-translate-x-16":"translate-x-0"),onClick:()=>W(e),onTouchStart:t=>L(t,e.id),onTouchMove:t=>Q(t,e.id),onTouchEnd:()=>B(),children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium",children:[e.check_in?(0,s.WU)(new Date(e.check_in),"HH:mm"):"-"," ~ ",e.check_out?(0,s.WU)(new Date(e.check_out),"HH:mm"):"진행중"]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.working_hours?Y(e.working_hours):"-"})]}),(0,r.jsx)("div",{className:"text-gray-400",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]})},e.id))})}):(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"오늘의 출퇴근 기록이 없습니다."})]})]})}},8667:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});let r=(0,n(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},3336:function(e,t,n){"use strict";n.d(t,{Av:function(){return l},Dg:function(){return a},F8:function(){return c},eh:function(){return o},lp:function(){return i},se:function(){return s}});var r=n(8667);async function l(e){let{data:{user:t}}=await r.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:n,error:l}=await r.O.from("time_entries").select("*").eq("date",e).eq("user_id",t.id).order("check_in",{ascending:!0});return l?(console.error("Error fetching time entries:",l),[]):n}async function i(e,t){let{data:{user:n}}=await r.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;console.log("출근 기록 생성 - 사용자 ID:",n.id);let{data:l,error:i}=await r.O.from("time_entries").insert([{date:e,check_in:t,check_out:null,working_hours:null,user_id:n.id}]).select();return i?(console.error("Error creating check-in entry:",i),null):l[0]}async function s(e,t,n){let{data:{user:l}}=await r.O.auth.getUser();if(!l)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:i,error:s}=await r.O.from("time_entries").update({check_out:t,working_hours:n}).eq("id",e).eq("user_id",l.id).select();return s?(console.error("Error updating check-out entry:",s),null):i[0]}async function a(e,t,n,l,i){let{data:{user:s}}=await r.O.auth.getUser();if(!s)return console.error("사용자가 로그인되어 있지 않습니다."),null;let a={check_in:t,check_out:n,working_hours:l};i&&(a.date=i);let{data:o,error:c}=await r.O.from("time_entries").update(a).eq("id",e).eq("user_id",s.id).select();return c?(console.error("Error updating time entry:",c),null):o[0]}async function o(e){let{data:{user:t}}=await r.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:n}=await r.O.from("time_entries").delete().eq("id",e).eq("user_id",t.id);return!n||(console.error("Error deleting time entry:",n),!1)}async function c(){console.log("getAllTimeEntries 함수 호출됨"),console.log("Supabase URL:","https://ijsggnmyblatollrvkhf.supabase.co"),console.log("Supabase Key 설정 여부:",!0);try{let{data:{user:e}}=await r.O.auth.getUser();if(!e)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:t,error:n}=await r.O.from("time_entries").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(n)return console.error("Error fetching all time entries:",n),[];return console.log("가져온 데이터 수:",t?t.length:0),t||[]}catch(e){return console.error("Exception in getAllTimeEntries:",e),[]}}},1825:function(e,t,n){"use strict";n.d(t,{D:function(){return l}});var r=n(1562);function l(e,t){var n;let l,h;let g=null!==(n=null==t?void 0:t.additionalDigits)&&void 0!==n?n:2,f=function(e){let t;let n={},r=e.split(i.dateTimeDelimiter);if(r.length>2)return n;if(/:/.test(r[0])?t=r[0]:(n.date=r[0],t=r[1],i.timeZoneDelimiter.test(n.date)&&(n.date=e.split(i.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length))),t){let e=i.timezone.exec(t);e?(n.time=t.replace(e[1],""),n.timezone=e[1]):n.time=t}return n}(e);if(f.date){let e=function(e,t){let n=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:NaN,restDateString:""};let l=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:null===i?l:100*i,restDateString:e.slice((r[1]||r[2]).length)}}(f.date,g);l=function(e,t){if(null===t)return new Date(NaN);let n=e.match(s);if(!n)return new Date(NaN);let r=!!n[4],l=c(n[1]),i=c(n[2])-1,a=c(n[3]),o=c(n[4]),u=c(n[5])-1;if(r)return o>=1&&o<=53&&u>=0&&u<=6?function(e,t,n){let r=new Date(0);r.setUTCFullYear(e,0,4);let l=r.getUTCDay()||7;return r.setUTCDate(r.getUTCDate()+((t-1)*7+n+1-l)),r}(t,o,u):new Date(NaN);{let e=new Date(0);return i>=0&&i<=11&&a>=1&&a<=(d[i]||(m(t)?29:28))&&l>=1&&l<=(m(t)?366:365)?(e.setUTCFullYear(t,i,Math.max(l,a)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!l||isNaN(l.getTime()))return new Date(NaN);let x=l.getTime(),y=0;if(f.time&&isNaN(y=function(e){let t=e.match(a);if(!t)return NaN;let n=u(t[1]),l=u(t[2]),i=u(t[3]);return(24===n?0===l&&0===i:i>=0&&i<60&&l>=0&&l<60&&n>=0&&n<25)?n*r.vh+l*r.yJ+1e3*i:NaN}(f.time)))return new Date(NaN);if(f.timezone){if(isNaN(h=function(e){if("Z"===e)return 0;let t=e.match(o);if(!t)return 0;let n="+"===t[1]?-1:1,l=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return i>=0&&i<=59?n*(l*r.vh+i*r.yJ):NaN}(f.timezone)))return new Date(NaN)}else{let e=new Date(x+y),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return new Date(x+y+h)}let i={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},s=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,a=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,o=/^([+-])(\d{2})(?::?(\d{2}))?$/;function c(e){return e?parseInt(e):1}function u(e){return e&&parseFloat(e.replace(",","."))||0}let d=[31,null,31,30,31,30,31,31,30,31,30,31];function m(e){return e%400==0||e%4==0&&e%100!=0}}},function(e){e.O(0,[549,792,493,971,69,744],function(){return e(e.s=8647)}),_N_E=e.O()}]);