(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{1086:function(e,t,r){Promise.resolve().then(r.bind(r,7546))},7546:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var s=r(3827),a=r(4090),n=r(8792),l=r(7835),c=r(9315),i=r(1263),d=r(666),o=r(9686),u=r(3437),h=r(5493),m=r(1825),x=r(7397),g=r(2674),p=r(8009);function b(){let[e,t]=(0,a.useState)(new Date),[r,b]=(0,a.useState)([]),[f,y]=(0,a.useState)(null),[j,w]=(0,a.useState)([]),[N,v]=(0,a.useState)(!0),[_,k]=(0,a.useState)(null),[M,S]=(0,a.useState)(0),[Z,E]=(0,a.useState)(!1),[O,P]=(0,a.useState)(null),[C,D]=(0,a.useState)(""),[F,I]=(0,a.useState)(""),[U,J]=(0,a.useState)(0),[W,Y]=(0,a.useState)(!1),[q,X]=(0,a.useState)(""),[z,A]=(0,a.useState)(!1);(0,a.useEffect)(()=>{console.log("Schedule 페이지 로드됨")},[]),(0,a.useEffect)(()=>{(async function(){try{v(!0),k(null);let t=await (0,g.s_)(e.getFullYear(),e.getMonth()+1);b(t||[]);let r=0;t.forEach(e=>{r+=parseFloat(e.planned_hours.toString())}),S(r),v(!1)}catch(e){console.error("Error loading work schedules:",e),k("근무 계획을 불러오는 중 오류가 발생했습니다: ".concat(e.message||String(e))),v(!1)}})()},[e]);let V=(0,i.N)(e),H=(0,d.V)(e),Q=(0,o.D)({start:V,end:H}),T=(0,u.w)(V),G=async t=>{if(W&&f&&f!==t){try{v(!0);let r=await (0,g.Yx)(j,t);if(r.success){p.ZP.success("근무 계획이 ".concat((0,h.WU)((0,m.D)(t),"yyyy년 MM월 dd일"),"에 복사되었습니다."),{duration:2e3});let r=await (0,g.s_)(e.getFullYear(),e.getMonth()+1);b(r||[])}else p.ZP.error(r.message||"근무 계획 복사 중 오류가 발생했습니다.")}catch(e){console.error("Error copying work schedules:",e),p.ZP.error(e.message||"근무 계획 복사 중 오류가 발생했습니다.")}finally{v(!1)}return}if(z&&t){try{v(!0);let r=await (0,g.Fs)(t);if(0===r.length){p.ZP.error("".concat((0,h.WU)((0,m.D)(t),"yyyy년 MM월 dd일"),"에는 삭제할 근무 계획이 없습니다.")),v(!1);return}let s=r.map(e=>(0,g.Nw)(e.id));await Promise.all(s),p.ZP.success("".concat((0,h.WU)((0,m.D)(t),"yyyy년 MM월 dd일"),"의 근무 계획 ").concat(r.length,"개가 삭제되었습니다."),{duration:2e3});let a=await (0,g.s_)(e.getFullYear(),e.getMonth()+1);b(a||[])}catch(e){console.error("Error deleting work schedules:",e),p.ZP.error(e.message||"근무 계획 삭제 중 오류가 발생했습니다.")}finally{v(!1)}return}y(t);try{let e=await (0,g.Fs)(t);w(e),K()}catch(e){console.error("Error fetching schedules for date:",e),p.ZP.error("해당 날짜의 근무 계획을 불러오는데 실패했습니다.")}};function R(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Math.floor(e),s=Math.round((e-r)*60);return t?"".concat(r,".").concat(Math.floor(s/6),"h"):"".concat(r,"시간 ").concat(s,"분")}let B=e=>{E(!1),P(e),D(e.start_time.substring(0,5)),I(e.end_time.substring(0,5)),J(e.planned_hours)},K=()=>{E(!1),P(null),D(""),I(""),J(0),Y(!1),X("")},L=(e,t)=>{if(!e||!t)return;let[r,s]=e.split(":").map(Number),[a,n]=t.split(":").map(Number),l=60*a+n-(60*r+s);l<0&&(l+=1440),J(parseFloat((l/60).toFixed(2)))},$=async()=>{if(!f||!C||!F){p.ZP.error("모든 필드를 입력해주세요.");return}try{v(!0),O?await (0,g.A0)(O.id,C,F,U)&&p.ZP.success("근무 계획이 수정되었습니다."):await (0,g.Xk)(f,C,F,U)&&(p.ZP.success("근무 계획이 추가되었습니다."),D("09:00"),I("18:00"),L("09:00","18:00"));let t=await (0,g.s_)(e.getFullYear(),e.getMonth()+1);if(b(t||[]),f){let e=await (0,g.Fs)(f);w(e)}O&&K()}catch(e){console.error("Error saving work schedule:",e),p.ZP.error("근무 계획 저장 중 오류가 발생했습니다.")}finally{v(!1)}},ee=async t=>{try{if(v(!0),await (0,g.Nw)(t)){p.ZP.success("근무 계획이 삭제되었습니다.");let r=await (0,g.s_)(e.getFullYear(),e.getMonth()+1);if(b(r||[]),f){let e=await (0,g.Fs)(f);w(e)}O&&O.id===t&&K()}}catch(e){console.error("Error deleting work schedule:",e),p.ZP.error("근무 계획 삭제 중 오류가 발생했습니다.")}finally{v(!1)}};return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)(p.x7,{position:"top-right"}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"근무 계획"}),(0,s.jsx)(n.default,{href:"/timer",className:"bg-primary text-white px-4 py-2 rounded hover:bg-blue-700",children:"출퇴근 기록"})]}),N&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,s.jsx)("span",{className:"ml-3",children:"데이터를 불러오는 중..."})]}),_&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,s.jsx)("p",{children:_}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"Supabase 연결 및 환경 변수를 확인해주세요."})]}),!N&&!_&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"근무 계획 요약"}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"이번 달 계획 근무 시간"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:R(M)})]})})]}),!N&&!_&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:()=>{t((0,l.W)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:"<"}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:(0,h.WU)(e,"yyyy년 MM월",{locale:x.ko})}),(0,s.jsx)("button",{onClick:()=>{t((0,c.z)(e,1))},className:"p-2 rounded-full hover:bg-gray-100",children:">"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["일","월","화","수","목","금","토"].map((e,t)=>(0,s.jsx)("div",{className:"text-center font-semibold p-2 ".concat(0===t?"text-red-600":6===t?"text-blue-600":""),children:e},e)),Array.from({length:T}).map((e,t)=>(0,s.jsx)("div",{className:"p-2 min-h-[60px]"},"empty-".concat(t))),Q.map(e=>{let t=(0,h.WU)(e,"yyyy-MM-dd"),a=r.filter(e=>e.date===t),n=0;a.forEach(e=>{n+=parseFloat(e.planned_hours.toString())});let l=a.length>0,c=f===t;return(0,s.jsxs)("div",{className:"p-2 min-h-[60px] border ".concat(c?"border-blue-500":W?"border-gray-200 hover:border-green-500":z?"border-gray-200 hover:border-red-500":"border-gray-200"," cursor-pointer hover:bg-gray-50 ").concat(W&&f===t?"bg-blue-50":""," ").concat(z?"hover:bg-red-50":""),onClick:()=>G(t),children:[(0,s.jsx)("div",{className:"font-medium ".concat(6===(0,u.w)(e)?"text-blue-600":0===(0,u.w)(e)?"text-red-600":""),children:(0,h.WU)(e,"d")}),l&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)("span",{className:"text-green-600 text-sm font-medium",children:R(n,!0)})})]},t)})]})]}),f&&!N&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:[(0,h.WU)((0,m.D)(f),"yyyy년 MM월 dd일"),(0,s.jsx)("br",{}),"근무 계획"]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{if(0===j.length){p.ZP.error("복사할 근무 계획이 없습니다.");return}Y(!0),p.ZP.success("복사 모드가 활성화되었습니다. 달력에서 여러 대상 날짜를 선택하세요. 완료 후 복사 취소 버튼을 클릭하세요.",{duration:5e3,icon:"\uD83D\uDD04"})},className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"계획 복사"}),(0,s.jsx)("button",{onClick:()=>{A(!0),p.ZP.success("삭제 모드가 활성화되었습니다. 달력에서 삭제할 날짜를 선택하세요. 완료 후 삭제 모드 종료 버튼을 클릭하세요.",{duration:5e3,icon:"\uD83D\uDDD1️"})},className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"계획 삭제"}),(0,s.jsx)("button",{onClick:()=>{E(!0),P(null),D("09:00"),I("18:00"),L("09:00","18:00")},className:"bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600",children:"+ 계획 추가"})]})]}),W&&(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-1",children:"근무 계획 복사 모드"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,h.WU)((0,m.D)(f),"yyyy년 MM월 dd일"),"의 근무 계획 ",j.length,"개를 여러 날짜에 복사할 수 있습니다. 달력에서 대상 날짜를 선택하세요."]})]}),(0,s.jsx)("button",{onClick:()=>{Y(!1),p.ZP.success("복사 모드가 취소되었습니다.")},className:"px-3 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50",children:"복사 모드 종료"})]}),z&&(0,s.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-1",children:"근무 계획 삭제 모드"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"달력에서 삭제할 날짜를 선택하세요. 해당 날짜의 모든 근무 계획이 삭제됩니다."})]}),(0,s.jsx)("button",{onClick:()=>{A(!1),p.ZP.success("삭제 모드가 취소되었습니다.")},className:"px-3 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50",children:"삭제 모드 종료"})]}),(Z||O)&&(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[(0,s.jsx)("h3",{className:"font-medium mb-3",children:O?"근무 계획 수정":"새 근무 계획 추가"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),(0,s.jsx)("input",{type:"time",value:C,onChange:e=>{let t=e.target.value;D(t),L(t,F)},className:"w-full p-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),(0,s.jsx)("input",{type:"time",value:F,onChange:e=>{let t=e.target.value;I(t),L(C,t)},className:"w-full p-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"계획 시간"}),(0,s.jsx)("div",{className:"p-2 border rounded bg-gray-100",children:R(U)})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:K,className:"px-3 py-1 border rounded hover:bg-gray-100",children:"취소"}),(0,s.jsx)("button",{onClick:$,className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"저장"})]})]}),j.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"시작 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종료 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"계획 시간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.start_time.substring(0,5)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.end_time.substring(0,5)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-green-600",children:R(e.planned_hours)}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>B(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"수정"}),(0,s.jsx)("button",{onClick:()=>ee(e.id),className:"text-red-600 hover:text-red-900",children:"삭제"})]})]},e.id))})]})}):(0,s.jsx)("div",{className:"text-center py-6 text-gray-500",children:Z?"새 근무 계획을 추가해주세요.":"이 날짜에 등록된 근무 계획이 없습니다. 계획 추가 버튼을 클릭하여 추가해주세요."})]})]})}},8667:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(3549).eI)("https://ijsggnmyblatollrvkhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc2dnbm15YmxhdG9sbHJ2a2hmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxOTk4NjMsImV4cCI6MjA2NDc3NTg2M30.K0y7U_XEuXJQRx_PZ_uFJy62Wal3bM4OT2eVM6mdHHQ")},2674:function(e,t,r){"use strict";r.d(t,{A0:function(){return i},Fs:function(){return l},Nw:function(){return d},Xk:function(){return c},Yx:function(){return a},s_:function(){return n}});var s=r(8667);async function a(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),{success:!1,message:"로그인이 필요합니다."};try{let a=[];for(let n of e){let{data:e,error:l}=await s.O.from("work_schedules").insert([{date:t,start_time:n.start_time,end_time:n.end_time,planned_hours:n.planned_hours,user_id:r.id}]).select();if(l)throw l;a.push(e[0])}return{success:!0,data:a}}catch(e){return console.error("Error copying work schedules:",e),{success:!1,message:e.message||"근무 계획 복사 중 오류가 발생했습니다."}}}async function n(e,t){let{data:{user:r}}=await s.O.auth.getUser();if(!r)return console.error("사용자가 로그인되어 있지 않습니다."),[];let a=t.toString().padStart(2,"0"),n="".concat(e,"-").concat(a,"-01"),l=12===t?"".concat(e+1,"-01-01"):"".concat(e,"-").concat((t+1).toString().padStart(2,"0"),"-01"),{data:c,error:i}=await s.O.from("work_schedules").select("*").eq("user_id",r.id).gte("date",n).lt("date",l).order("date",{ascending:!0}).order("start_time",{ascending:!0});return i?(console.error("Error fetching work schedules:",i),[]):c||[]}async function l(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),[];let{data:r,error:a}=await s.O.from("work_schedules").select("*").eq("date",e).eq("user_id",t.id).order("start_time",{ascending:!0});return a?(console.error("Error fetching work schedules for date:",a),[]):r||[]}async function c(e,t,r,a){let{data:{user:n}}=await s.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:c}=await s.O.from("work_schedules").insert([{date:e,start_time:t,end_time:r,planned_hours:a,user_id:n.id}]).select();return c?(console.error("Error creating work schedule:",c),null):l[0]}async function i(e,t,r,a){let{data:{user:n}}=await s.O.auth.getUser();if(!n)return console.error("사용자가 로그인되어 있지 않습니다."),null;let{data:l,error:c}=await s.O.from("work_schedules").update({start_time:t,end_time:r,planned_hours:a,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",n.id).select();return c?(console.error("Error updating work schedule:",c),null):l[0]}async function d(e){let{data:{user:t}}=await s.O.auth.getUser();if(!t)return console.error("사용자가 로그인되어 있지 않습니다."),!1;let{error:r}=await s.O.from("work_schedules").delete().eq("id",e).eq("user_id",t.id);return!r||(console.error("Error deleting work schedule:",r),!1)}}},function(e){e.O(0,[549,792,493,400,9,971,69,744],function(){return e(e.s=1086)}),_N_E=e.O()}]);